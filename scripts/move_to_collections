db.emaildatas.find().snapshot().forEach(
    function(doc){
        db.emailDetails.findOneAndUpdate({"from_email":doc.from_email,"user_id":doc.user_id},
       { $set:  {
                "to_email":doc.to_email,
                "from_email_name":doc.from_email_name,
                "from_email":doc.from_email,
                "labelIds":doc.labelIds.split(','),
                "labelIds":doc.labelIds,
                "status_date":doc.status_date,
                "status":doc.status,
                "user_id":doc.user_id
            }
       },{upsert:true})
        db.emailInfo.save(
            {
                "email_id":doc.email_id,
                "subject":doc.subject,
                "unsubscribe":doc.unsubscribe,
                "historyId":doc.historyId,
                "labelIds":doc.labelIds.split(','),
                "main_label":doc.main_label,
                "from_email_id":db.emailDetails.findOne({"from_email":doc.from_email})._id
            })
    }
);

db.emaildatas.find().snapshot().forEach(
    function (doc) {
        db.emailDetails.save({
                "_id":doc._id,
                "to_email":doc.to_email,
                "from_email_name":doc.from_email_name,
                "from_email":doc.from_email,
                "historyId":doc.historyId,
                "labelIds":doc.labelIds.split(','),
                "main_label":doc.main_label,
                "labelIds":doc.labelIds,
                "status_date":doc.status_date,
                "status":doc.status,
                "user_id":doc.user_id
            });
    }
);

db.emaildatas.find().snapshot().forEach(
    function (doc) {
        db.emailInfo.save(
            {
                "email_id":doc.email_id,
                "subject":doc.subject,
                "unsubscribe":doc.unsubscribe,
                "historyId":doc.historyId,
                "labelIds":doc.labelIds.split(','),
                "main_label":doc.main_label,
                "from_email_id":doc._id
            }
        );
    }
);

db.userdetails.find().snapshot().forEach(
    function (doc) {
        db.user.save(doc);
    }
);